<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Generator Pro - Premium CV Creator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&family=Inter:wght@400;600&family=Montserrat:wght@600;700&family=Raleway:wght@400;600&family=Lato:wght@400;700&family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600&family=Nunito:wght@600;700&family=Quicksand:wght@600;700&family=Source+Sans+Pro:wght@400;600&family=Arvo:wght@700&family=Caveat:wght@700&family=Oswald:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=3">
    <link rel="stylesheet" href="style-responsive.css?v=2">
    <link rel="stylesheet" href="style-mobile-improved.css?v=2">
    <link rel="stylesheet" href="style-pages.css?v=2">
    <style>
        /* ===== CRITICAL CSS - CHARGÃ‰ IMMÃ‰DIATEMENT ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Optimisation pour mobile - Ã©vite le zoom sur les inputs */
        input, select, textarea, button {
            font-size: 16px !important;
        }

        /* ARIA live region pour les annonces d'accessibilitÃ© */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* EmpÃªche le zoom sur iOS lors du focus */
        body {
            touch-action: manipulation;
        }
    </style>
</head>
<body>
    <div class="cv-editor" id="cvEditor">
        <!-- MOBILE TOGGLE BUTTON -->
        <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- MAIN EDITOR AREA WITH PREVIEW -->
        <div class="editor-main">
            <!-- CV PREVIEW CONTAINER - Left side on desktop, top on mobile -->
            <div class="cv-preview-container" id="cvPreviewContainer">
                <div class="cv-preview" id="cvPreview">
                    <div class="cv-preview-content" id="cvPreviewContent">
                        <!-- Preview will be rendered here by script.js updatePreview() -->
                    </div>
                </div>
            </div>

            <!-- TOOLBAR - Bottom on mobile, bottom on all -->
            <div class="editor-toolbar" id="editorToolbar">
                <!-- Section Zoom et Navigation Pages -->
                <div class="toolbar-section">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="previousPage()" title="Page prÃ©cÃ©dente">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="toolbar-btn" onclick="zoomOut()" title="Zoom arriÃ¨re">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="toolbar-btn" onclick="resetZoom()" title="Zoom normal">
                            <span id="zoomLevelDisplay">100%</span>
                        </button>
                        <button class="toolbar-btn" onclick="zoomIn()" title="Zoom avant">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="toolbar-btn" onclick="nextPage()" title="Page suivante">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Section Gestion des Pages -->
                <div class="toolbar-section">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="addPage()" title="Ajouter une page">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="toolbar-btn" onclick="removePage()" title="Supprimer la page">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="toolbar-btn" id="autoPageBtn" title="Mode auto/manual" onclick="toggleAutoPage()">
                            <i class="fas fa-magic"></i>
                            <span>Auto</span>
                        </button>
                    </div>
                    <div class="page-indicator">
                        <span id="currentPageDisplay">Page 1/1</span>
                    </div>
                </div>

                <!-- Section Actions Rapides -->
                <div class="toolbar-section">
                    <div class="toolbar-group">
                        <button class="toolbar-btn primary" onclick="exportPDF()" title="Exporter PDF">
                            <i class="fas fa-file-pdf"></i>
                            <span>PDF</span>
                        </button>
                        <button class="toolbar-btn" onclick="toggleSidebar()" title="Menu" id="menuToggleToolbar">
                            <i class="fas fa-bars"></i>
                            <span>Menu</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SIDEBAR WITH FORMS - Right side on desktop, overlay on mobile -->
        <aside class="editor-sidebar" id="editorSidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-file-alt"></i> CV Pro</h1>
                <p>CrÃ©ateur Premium</p>
                <button class="sidebar-close" id="sidebarClose" onclick="closeSidebar()" style="display:none;" aria-label="Close sidebar">
                    <i class="fas fa-times"></i>
                </button>
                <button class="theme-toggle" id="themeToggle" onclick="toggleDarkMode()" title="Basculer thÃ¨me sombre/clair" style="margin-top: 0.5rem; width: 100%;">
                    <i class="fas fa-moon"></i> Mode sombre
                </button>
            </div>

            <!-- TABS -->
            <nav class="editor-nav" role="tablist">
                <button class="nav-btn active" data-tab="content" onclick="switchTab('content')" role="tab" aria-selected="true" aria-controls="tab-content">
                    <i class="fas fa-edit"></i> Contenu
                </button>
                <button class="nav-btn" data-tab="design" onclick="switchTab('design')" role="tab" aria-selected="false" aria-controls="tab-design">
                    <i class="fas fa-palette"></i> Design
                </button>
                <button class="nav-btn" data-tab="export" onclick="switchTab('export')" role="tab" aria-selected="false" aria-controls="tab-export">
                    <i class="fas fa-download"></i> Export
                </button>
            </nav>

            <!-- TAB: CONTENU -->
            <div class="tab-panel active" id="tab-content">
                
                <!-- MODÃˆLES EXEMPLES -->
                <div class="panel-section">
                    <h3><i class="fas fa-sparkles"></i> ModÃ¨les</h3>
                    <div class="examples-grid">
                        <button class="example-btn" onclick="loadExample('dev')" aria-label="Charger modÃ¨le dÃ©veloppeur" title="Dev">ðŸ’»</button>
                        <button class="example-btn" onclick="loadExample('designer')" aria-label="Charger modÃ¨le designer" title="Designer">ðŸŽ¨</button>
                        <button class="example-btn" onclick="loadExample('startup')" aria-label="Charger modÃ¨le startup" title="Startup">ðŸš€</button>
                        <button class="example-btn" onclick="loadExample('marketing')" aria-label="Charger modÃ¨le marketing" title="Marketing">ðŸ“Š</button>
                        <button class="example-btn" onclick="loadExample('datascientist')" aria-label="Charger modÃ¨le data scientist" title="Data">ðŸ¤–</button>
                        <button class="example-btn" onclick="loadExample('manager')" aria-label="Charger modÃ¨le manager" title="Manager">ðŸ‘”</button>
                    </div>
                </div>

                <!-- SECTION 1: PROFIL -->
                <div class="panel-section">
                    <h3><i class="fas fa-user-circle"></i> Profil Personnel</h3>

                    <div class="form-group">
                        <label><i class="fas fa-image"></i> Photo</label>
                        <div class="photo-upload-box" onclick="document.getElementById('photoInput').click()">
                            <div id="photoPreview" class="photo-preview-area"></div>
                            <p>Cliquer pour ajouter une photo</p>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" onchange="handlePhotoUpload(event)" style="display:none">
                    </div>

                    <div class="form-group">
                        <label>Nom Complet</label>
                        <input type="text" id="fullName" placeholder="Jean Dupont" oninput="updatePreview()">
                    </div>

                    <div class="form-group">
                        <label>Titre Professionnel</label>
                        <input type="text" id="jobTitle" placeholder="IngÃ©nieur Senior" oninput="updatePreview()">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="email" placeholder="email@example.com" oninput="updatePreview()">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> TÃ©lÃ©phone</label>
                            <input type="tel" id="phone" placeholder="+33 6 00 00 00 00" oninput="updatePreview()">
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-map-marker"></i> Localisation</label>
                        <input type="text" id="location" placeholder="Paris, France" oninput="updatePreview()">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Ã€ Propos</label>
                        <textarea id="about" placeholder="DÃ©crivez votre profil professionnel..." rows="4" oninput="updatePreview()"></textarea>
                    </div>
                </div>

                <!-- SECTION 2: FORMATION -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3><i class="fas fa-graduation-cap"></i> Formation</h3>
                        <button class="btn-add-item" onclick="addEducation()"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="educationList"></div>
                </div>

                <!-- SECTION 3: EXPÃ‰RIENCES -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3><i class="fas fa-briefcase"></i> ExpÃ©riences</h3>
                        <button class="btn-add-item" onclick="addExperience()"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="experienceList"></div>
                </div>

                <!-- SECTION 4: COMPÃ‰TENCES -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cogs"></i> CompÃ©tences</h3>
                        <button class="btn-add-item" onclick="addSkill()"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="skillsList"></div>
                </div>

                <!-- SECTION 5: LANGUES -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3><i class="fas fa-globe"></i> Langues</h3>
                        <button class="btn-add-item" onclick="addLanguage()"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="languagesList"></div>
                </div>

                <!-- SECTION 6: INTÃ‰RÃŠTS -->
                <div class="panel-section">
                    <div class="section-header">
                        <h3><i class="fas fa-heart"></i> IntÃ©rÃªts</h3>
                        <button class="btn-add-item" onclick="addInterest()"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="interestsList"></div>
                </div>

            </div>

            <!-- TAB: DESIGN -->
            <div class="tab-panel" id="tab-design">
                
                <div class="panel-section">
                    <h3><i class="fas fa-layer-group"></i> Templates</h3>
                    <div class="templates-grid">
                        <button class="template-btn active" data-template="minimal" onclick="switchTemplate('minimal')">Minimal</button>
                        <button class="template-btn" data-template="classic" onclick="switchTemplate('classic')">Classique</button>
                        <button class="template-btn" data-template="modern" onclick="switchTemplate('modern')">Moderne</button>
                        <button class="template-btn" data-template="luxury" onclick="switchTemplate('luxury')">Luxury</button>
                        <button class="template-btn" data-template="creative" onclick="switchTemplate('creative')">CrÃ©atif</button>
                        <button class="template-btn" data-template="tech" onclick="switchTemplate('tech')">Tech</button>
                        <button class="template-btn" data-template="professionnel" onclick="switchTemplate('professionnel')">Pro 2Col</button>
                        <button class="template-btn" data-template="elegant" onclick="switchTemplate('elegant')">Ã‰lÃ©gant</button>
                        <button class="template-btn" data-template="corporate" onclick="switchTemplate('corporate')">Corporate</button>
                        <button class="template-btn" data-template="academic" onclick="switchTemplate('academic')">Academic</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3><i class="fas fa-fill-drip"></i> Couleur Principale</h3>
                    <div class="color-palette">
                        <div class="color-swatch" data-color="#00eeff" style="background: #00eeff;" title="Cyan" onclick="setColor('#00eeff')"></div>
                        <div class="color-swatch" data-color="#ff6600" style="background: #ff6600;" title="Orange" onclick="setColor('#ff6600')"></div>
                        <div class="color-swatch" data-color="#1a5f7a" style="background: #1a5f7a;" title="Bleu" onclick="setColor('#1a5f7a')"></div>
                        <div class="color-swatch" data-color="#000000" style="background: #000000;" title="Noir" onclick="setColor('#000000')"></div>
                        <div class="color-swatch" data-color="#e91e63" style="background: #e91e63;" title="Rose" onclick="setColor('#e91e63')"></div>
                        <div class="color-swatch" data-color="#4CAF50" style="background: #4CAF50;" title="Vert" onclick="setColor('#4CAF50')"></div>
                    </div>
                    <div class="color-input-wrapper" style="margin-top: 10px;">
                        <input type="color" id="primaryColor" value="#00eeff" oninput="updatePreview(); syncColorHex(this.value)">
                        <span id="primaryColorHex">#00eeff</span>
                    </div>
                </div>

                <div class="panel-section">
                    <h3><i class="fas fa-typography"></i> Typographie</h3>
                    
                    <div class="form-group">
                        <label>Police Titre</label>
                        <select id="fontTitle" onchange="updatePreview()">
                            <option value="Poppins">Poppins</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Raleway">Raleway</option>
                            <option value="Oswald">Oswald</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Police Corps</label>
                        <select id="fontBody" onchange="updatePreview()">
                            <option value="Poppins">Poppins</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Inter">Inter</option>
                            <option value="Nunito">Nunito</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Nom (Size)</label>
                        <div class="size-input-wrapper">
                            <input type="range" id="nameSize" min="24" max="52" value="36" oninput="updatePreview(); document.getElementById('nameSizeDisplay').textContent = this.value + 'px'">
                            <span id="nameSizeDisplay">36px</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-briefcase"></i> Titre Professionnel</label>
                        <div class="size-input-wrapper">
                            <input type="range" id="jobTitleSize" min="12" max="20" value="16" oninput="updatePreview(); document.getElementById('jobTitleSizeDisplay').textContent = this.value + 'px'">
                            <span id="jobTitleSizeDisplay">16px</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-info-circle"></i> MÃ©tadonnÃ©es</label>
                        <div class="size-input-wrapper">
                            <input type="range" id="metaSize" min="8" max="14" value="11" oninput="updatePreview(); document.getElementById('metaSizeDisplay').textContent = this.value + 'px'">
                            <span id="metaSizeDisplay">11px</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Titres Sections</label>
                        <div class="size-input-wrapper">
                            <input type="range" id="sectionTitleSize" min="12" max="22" value="16" oninput="updatePreview(); document.getElementById('sectionTitleSizeDisplay').textContent = this.value + 'px'">
                            <span id="sectionTitleSizeDisplay">16px</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Taille Corps</label>
                        <div class="size-input-wrapper">
                            <input type="range" id="bodyFontSize" min="10" max="16" value="13" oninput="updatePreview(); document.getElementById('bodySizeDisplay').textContent = this.value + 'px'">
                            <span id="bodySizeDisplay">13px</span>
                        </div>
                    </div>
                </div>

            </div>

            <!-- TAB: EXPORT -->
            <div class="tab-panel" id="tab-export">

                <div class="panel-section">
                    <h3><i class="fas fa-download"></i> Exporter</h3>
                    
                    <button class="export-btn primary" onclick="exportPDF()" aria-label="Exporter en PDF">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    
                    <button class="export-btn" onclick="exportPNG()" aria-label="Exporter en PNG">
                        <i class="fas fa-image"></i> PNG
                    </button>

                    <button class="export-btn" onclick="exportJSON()" aria-label="Sauvegarder le CV">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>

                    <button class="export-btn secondary" onclick="triggerJSONImport()" aria-label="Charger un CV sauvegardÃ©">
                        <i class="fas fa-upload"></i> Charger
                    </button>

                    <input type="file" id="jsonInput" accept=".json" style="display:none" onchange="importJSON(event)">
                </div>

                <div class="panel-section">
                    <h3><i class="fas fa-arrow-left"></i> Navigation</h3>
                    
                    <button class="export-btn secondary" onclick="goBack()">
                        <i class="fas fa-home"></i> Retour
                    </button>
                </div>

            </div>
        </aside>
    </div>

    <!-- TOAST NOTIFICATIONS CONTAINER -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ARIA LIVE REGION FOR ACCESSIBILITY -->
    <div class="sr-only" role="status" aria-live="polite" id="ariaStatus"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- ===== MODULE FIREBASE INIT ===== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, deleteDoc, doc, updateDoc, getDocs, getDoc, setDoc, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDCZZ6f8SmLwGG0Z9eH3mXe4-2tOfUyXO0",
            authDomain: "valde-tech.firebaseapp.com",
            projectId: "valde-tech",
            storageBucket: "valde-tech.appspot.com",
            messagingSenderId: "370909297073",
            appId: "1:370909297073:web:eb670e5f48fdd097f01e80"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Expose to window
        window.db = db;
        window.auth = auth;
        window.getFirestore = getFirestore;
        window.collection = collection;
        window.addDoc = addDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;
        window.orderBy = orderBy;
        window.where = where;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.getDocs = getDocs;
        window.getDoc = getDoc;
        window.increment = increment;
        window.serverTimestamp = serverTimestamp;
        window.setDoc = setDoc;
        window.signInAnonymously = signInAnonymously;
    </script>
    
    <!-- ===== SESSION SECURITY MANAGER - LOAD FIRST ===== -->
    <script src="session-manager.js?v=1"></script>
    
    <!-- ===== SCRIPT.JS - Main application logic ===== -->
    <script src="page-manager.js?v=2"></script>
    <script src="script.js?v=9"></script>
    
    <!-- ===== FIREBASE CV CONFIG - After script.js loaded ===== -->
    <script src="firebase-cv-config.js?v=4"></script>
    
    <!-- ===== MOBILE UI IMPROVEMENTS ===== -->
    <script src="mobile-ui.js?v=3"></script>
</body>
</html>
